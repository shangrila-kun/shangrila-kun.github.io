---
title: nginx的哪些坑
date: 2017-12-02 10:34:55
tags: nginx
toc: true
categories: 运维
author: shangrila-kun
---

​	本文主要内容记载我在学习nginx中遇到的各种问题。

<!--more-->

## wordpress更改默认端口的方法

> 通过nginx转发到wordpress博客时，我们不想把80端口给wordpress时，我们需要通过nginx监听到80端口，然后准发到指定的wordpress的端口，wordpress默认端口是80端口。

### 方法一

> 也可以先使用更改前的端口80访问wordpress，在控制板的设置里面，找到wordpress地址（url），改为端口号，站点地址也该为端口号。
>
> 如图：
>
> ![123.png](http://upload-images.jianshu.io/upload_images/7882280-286bef55b46d19db.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

### 方法二

> 那就直接修改数据库中表wp_options，
>
> 1. **update** wp_options **set** option_value='http://IP:18070' **where** option_name='siteurl';  
> 2. **update** wp_options **set** option_value='http://IP:18070' **where** option_name='home';  

### nginx转发代码

~~~shell
server{
  2     listen 80;
  3     server_name www.abc.com;
  4     location /{
  5             proxy_pass http://127.0.0.1:18070;//此处的端口就是在wordpress后台或者mysql表结构里面改的端口，通过nginx代理到该端口号上去。
  6     }
  7 }
  8 
  9 server{
 10     listen 18070;
 11     location ~ ^/.*\.php$ {
 12         root /usr/local/web/wlsdata;//静态页面的地址。
 13         fastcgi_pass   127.0.0.1:9000;
 14         fastcgi_index  index.php;
 15         fastcgi_param  SCRIPT_FILENAME  /usr/local/web/wlsdata$fastcgi_script_name;
 16         include        fastcgi_params;
 17          gzip on;
 18     gzip_min_length 1100;
 19     gzip_buffers 4 8k;
 20     gzip_types text/plain application/x-javascript text/css image;
 21     }
 22     location ~ .*\.(html|htm|gif|jpg|jpeg|bmp|png|ico|txt|js|css)$ {
 23             expires 30d;
 24             root /usr/local/web/wlsdata;
 25         }
 26      location / {
 27             root   /usr/local/web/wlsdata;//静态页面的地址。
 28             index  index.php ;
 29      }
 30 }

~~~

